<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Introduction &#8212; populse_db 3.0.10 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css?v=fce32b03" />
    <script src="_static/documentation_options.js?v=d28a59c5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="#">
          <span>populse_db 3.0.10 documentation</span></a></h1>
        <h2 class="heading"><span>Introduction</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        <a class="uplink" href="#">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <div class="toctree-wrapper compound">
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="./index.html">Index</a></p></td>
<td><p><a class="reference external" href="./documentation.html">Documentation</a></p></td>
<td><p><a class="reference external" href="https://github.com/populse/populse_db">GitHub</a></p></td>
</tr>
</tbody>
</table>
<section id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h1>
<p>populse_db is a small Python module aiming is to store and query efficiently JSON data with the following constraints:</p>
<ul class="simple">
<li><p><strong>Storage on file system</strong>: The data must be stored on a standard file system and
respect all system access rights.</p></li>
<li><p><strong>Parallel access</strong>: Multiple processes or threads must be able to read or modify
data in parallel.</p></li>
<li><p><strong>Use a few files</strong>: populse_db store data in a single file. In some environment
where the number of inodes is limited, it is vital that data storage have also a
reasonable limit on the number of files it produces.</p></li>
<li><p><strong>No schema required</strong>: populse_db can be used without thinking about
database schema. But it is also possible to define some pieces of schema in order
to optimize query performances on some JSON attributes or to define a
partitioning of the data.</p></li>
<li><p><strong>Date and time support</strong>: populse_db support items of type <cite>datetime.time</cite>,
<cite>datetime.date</cite> and <cite>datetime.datetime</cite> in JSON objects. These items are
automatically encoded (resp. decoded) to (resp. from) strings using ISO
format.</p></li>
<li><p><strong>Query list elements</strong>: populse_db has a simple query language that
allows to select objects by looking for items in list fields.</p></li>
<li><p><strong>Transactions support</strong>: to ensure the consistency of the database,
populse_db allows all modifications to be made within a transaction.
Thus, in case of unexpected problem, the database will keep its initial
state before the transaction.</p></li>
<li><p><strong>Partitioning of JSON objects</strong>: populse_db allows to read or modify
individually each stored object. But it also allows to define a
partitioning of the objects offering a direct access to different parts of
the same object without having to read or write the whole object (as it would
be using a simple JSON file).</p></li>
</ul>
<p>populse_db offers a simple API on top of a SQLite backend that allows to respect all the requirements.</p>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Link to this heading">¶</a></h2>
<p>Install tools take care of all the required dependencies for you but here is a
summary of what populse_db needs:</p>
<ul class="simple">
<li><p>Python &gt;= 3.9. populse_db uses some features introduced in Python 3.9 (such
as the possibility to subscript list type as in <code class="docutils literal notranslate"><span class="pre">list[str]</span></code>). Therefore it
can’t work with Python 3.8 or earlier releases.</p></li>
<li><p><a class="reference external" href="https://dateutil.readthedocs.io/">dateutil</a></p></li>
<li><p><a class="reference external" href="https://github.com/lark-parser/lark/">Lark-parser</a> &gt;= 0.7.0.</p></li>
<li><p><em>[optional]</em> <a class="reference external" href="https://www.sphinx-doc.org/">Sphinx</a> allows to build the
documentation from source code.</p></li>
</ul>
</section>
</section>
<section id="get-started">
<h1>Get started<a class="headerlink" href="#get-started" title="Link to this heading">¶</a></h1>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p>Populse_db can be installed by standard Python tool. For instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">populse_db</span>
</pre></div>
</div>
<p>The documentation is embedded in the project. However, if one needs to rebuild
the documentation, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">populse_db</span><span class="p">[</span><span class="n">doc</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="basic-usage">
<h2>Basic usage<a class="headerlink" href="#basic-usage" title="Link to this heading">¶</a></h2>
<p>Populse_db is organized in <em>collections</em> and <em>documents</em>. A document is a JSON
object represented by a dictionary in Python. A collection is a named container
in which documents can be stored. Internally, collections corresponds to
database tables and documents are stored in table rows (one document per row).
But  populse_db can hide this internal database stuff. The only thing user
must do is to declare its collections if it uses an empty database. This is
illustrated in the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">date</span><span class="p">,</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">populse_db</span><span class="w"> </span><span class="kn">import</span> <span class="n">Storage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>

<span class="c1"># Create a storage using a file name</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">Storage</span><span class="p">(</span><span class="s1">&#39;/tmp/populse_db.sqlite&#39;</span><span class="p">)</span>
<span class="c1"># Create a read/write session</span>
<span class="k">with</span> <span class="n">storage</span><span class="o">.</span><span class="n">session</span><span class="p">(</span><span class="n">write</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
   <span class="n">db</span><span class="o">.</span><span class="n">last_modified</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

   <span class="c1"># Store documents in the database</span>
   <span class="n">db</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span><span class="s1">&#39;subject_id&#39;</span><span class="p">)</span>
   <span class="n">db</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">][</span><span class="s1">&#39;rbndt001&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Eléa&#39;</span><span class="p">,</span>
      <span class="s1">&#39;sex&#39;</span><span class="p">:</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span>
      <span class="s1">&#39;birth_date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">(</span><span class="mi">1968</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
   <span class="p">}</span>
   <span class="n">db</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">][</span><span class="s1">&#39;rbndt002&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Païkan&#39;</span><span class="p">,</span>
      <span class="s1">&#39;sex&#39;</span><span class="p">:</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span>
      <span class="s1">&#39;birth_date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">(</span><span class="mi">1963</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
   <span class="p">}</span>
   <span class="n">db</span><span class="p">[</span><span class="s1">&#39;acquisition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Storage</span><span class="o">.</span><span class="n">Collection</span><span class="p">()</span>
   <span class="n">db</span><span class="p">[</span><span class="s1">&#39;acquisition&#39;</span><span class="p">][</span><span class="s1">&#39;rbndt001_t1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;subject_id&#39;</span><span class="p">:</span> <span class="s1">&#39;rbndt001&#39;</span><span class="p">,</span>
      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;mri&#39;</span><span class="p">,</span> <span class="s1">&#39;T1&#39;</span><span class="p">],</span>
      <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;DICOM&#39;</span><span class="p">,</span>
      <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;/somewhere/t1/acq0001.dcm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/somewhere/t1/acq0002.dcm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/somewhere/t1/acq0003.dcm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/somewhere/t1/acq0004.dcm&#39;</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span>
   <span class="p">}</span>
   <span class="n">db</span><span class="p">[</span><span class="s1">&#39;acquisition&#39;</span><span class="p">][</span><span class="s1">&#39;rbndt001_t2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;subject_id&#39;</span><span class="p">:</span> <span class="s1">&#39;rbndt001&#39;</span><span class="p">,</span>
      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;mri&#39;</span><span class="p">,</span> <span class="s1">&#39;T2&#39;</span><span class="p">],</span>
      <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;DICOM&#39;</span><span class="p">,</span>
      <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;/somewhere/t2/acq0001.dcm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/somewhere/t2/acq0002.dcm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/somewhere/t2/acq0003.dcm&#39;</span><span class="p">,</span>
            <span class="s1">&#39;/somewhere/t2/acq0004.dcm&#39;</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span>
   <span class="p">}</span>
   <span class="n">db</span><span class="p">[</span><span class="s1">&#39;acquisition&#39;</span><span class="p">][</span><span class="s1">&#39;rbndt002_t1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;subject_id&#39;</span><span class="p">:</span> <span class="s1">&#39;rbndt002&#39;</span><span class="p">,</span>
      <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;mri&#39;</span><span class="p">,</span> <span class="s1">&#39;T1&#39;</span><span class="p">],</span>
      <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;NIFTI&#39;</span><span class="p">,</span>
      <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;/elsewhere/sub-rbndt001.nii&#39;</span><span class="p">,</span>
      <span class="p">],</span>
      <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span>
   <span class="p">}</span>

   <span class="c1"># Retrieve a single value from storage</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Last modified:&#39;</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">last_modified</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

   <span class="c1"># Retrieve a single document from collection &#39;subject&#39;</span>
   <span class="n">pprint</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">][</span><span class="s1">&#39;rbndt001&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

   <span class="c1"># Retrieve all documents from collection &#39;subject&#39; respecting the</span>
   <span class="c1"># following conditions:</span>
   <span class="c1">#   - the &quot;subject&quot; field equals to &quot;rbndt001&quot;</span>
   <span class="c1">#   - the &quot;type&quot; field is a list containing the value &quot;T1&quot;</span>
   <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">db</span><span class="p">[</span><span class="s1">&#39;acquisition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;subject==&quot;rbndt001&quot; and &quot;T1&quot; in type&#39;</span><span class="p">):</span>
      <span class="n">pprint</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</pre></div>
</div>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
The example shows how to use populse_db to store and retrieve JSON
=======</p>
<blockquote>
<div><p># Retrieve all possible types of acquisition
print(‘Subjects:’, ‘, ‘.join(db.subject.distinct_values(‘subject_id’)))</p>
</div></blockquote>
<p>The example above illustrate how to use populse_db to store and retrieve JSON
&gt;&gt;&gt;&gt;&gt;&gt;&gt; origin/master
objects without wondering about the underlying SQL database engine. This script
produces the following result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;birth_date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1968</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
 <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Eléa&#39;</span><span class="p">,</span>
 <span class="s1">&#39;primary_key&#39;</span><span class="p">:</span> <span class="s1">&#39;rbndt001&#39;</span><span class="p">,</span>
 <span class="s1">&#39;sex&#39;</span><span class="p">:</span> <span class="s1">&#39;f&#39;</span><span class="p">}</span>
<span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2022</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span>
 <span class="s1">&#39;files&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;/somewhere/t1/acq0001.dcm&#39;</span><span class="p">,</span>
         <span class="s1">&#39;/somewhere/t1/acq0002.dcm&#39;</span><span class="p">,</span>
         <span class="s1">&#39;/somewhere/t1/acq0003.dcm&#39;</span><span class="p">,</span>
         <span class="s1">&#39;/somewhere/t1/acq0004.dcm&#39;</span><span class="p">],</span>
 <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;DICOM&#39;</span><span class="p">,</span>
 <span class="s1">&#39;primary_key&#39;</span><span class="p">:</span> <span class="s1">&#39;rbndt001_t1&#39;</span><span class="p">,</span>
 <span class="s1">&#39;subject&#39;</span><span class="p">:</span> <span class="s1">&#39;rbndt001&#39;</span><span class="p">,</span>
 <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;mri&#39;</span><span class="p">,</span> <span class="s1">&#39;T1&#39;</span><span class="p">]}</span>
</pre></div>
</div>
<p>To further understand how to use populse_db, see the <a class="reference external" href="./tutorial.html">tutorial</a></p>
</section>
</section>
<section id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Link to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        <a class="uplink" href="#">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2022, populse team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.3.0.
    </div>
  </body>
</html>